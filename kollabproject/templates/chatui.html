{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Chat Application</title>
 <link rel="stylesheet" href="{% static 'chatuicss.css' %}">
</head>
<body>
   
    <div class="sidebar">
        <div class="sidebar-logo">
            <img src="/static/logo.png" alt="KollabHub" />
        
            <h2>KollabHub</h2>
        </div>
        <div class="sidebar-menu">
            <button class="active">
                <span class="icon">👥</span>
                Groups
            </button>
            <button>
                <span class="icon">💬</span>
                Direct Messages
            </button>

 <!-- Dynamic members list -->
    <ul class="direct-members">
        {% for membership in members %}
            {% if membership.user != request.user %}
                <li>
                    <span class="icon">👤</span>
                    {{ membership.user.display_name|default:membership.user.username }}
                </li>
            {% endif %}
        {% empty %}
            <li>No members yet</li>
        {% endfor %}
    </ul>



            <button id="openInviteModal">
                <span class="icon">➕</span>
                Invite People
            </button>
        </div>
        <div class="spacer"></div>
        <div class="sidebar-footer">

            <button id="openProfileBtn">
  <span class="icon">👤</span> Profile
</button>
            <a href="{% url 'logout' %}" class="sidebar-btn" style="display: flex; align-items: center; gap: 12px; color: white; text-decoration: none; padding: 12px 16px; border-radius: 10px;">
            <span class="icon">
            <!-- Logout SVG icon -->
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M16 17L21 12L16 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12H9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 19V17C12 15.8954 11.1046 15 10 15H5C3.89543 15 3 15.8954 3 17V19C3 20.1046 3.89543 21 5 21H10C11.1046 21 12 20.1046 12 19Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            </span>
            Logout
            </a>

            <button id="openSettingsBtn">⚙️ Settings</button>
            {% comment %} <button>
                <span class="icon">⚙️</span>
                Settings
            </button> {% endcomment %}
        </div>
    </div>
    <div class="chat-container">

        {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="message {{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
 
       
         <div class="chat-header">
            <div class="chat-header-left">
                {% if workspace and workspace.image %}
                    <img src="{{ workspace.image.url }}" alt="Workspace Image" />
                {% else %}
                    <img src="/static/logo.png" alt="logo" />
                {% endif %}
                <h2>{{ workspace.title|default:"Workspace" }}</h2>
            </div>
            <div class="chat-header-actions">
                <button title="Call">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="#fff">
                        <path d="M6.62 10.79a15.05 15.05 0 006.59 6.59l2.2-2.2a1 1 0 011.11-.21c1.21.49 2.53.76 3.88.76a1 1 0 011 1v3.5a1 1 0 01-1 1C7.61 22 2 16.39 2 9.5a1 1 0 011-1H6.5a1 1 0 011 1c0 1.35.27 2.67.76 3.88a1 1 0 01-.21 1.11l-2.2 2.2z" fill="#2196f3"/>
                    </svg>
                </button>
                <button title="Video">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="#2196f3">
                        <rect x="3" y="7" width="13" height="10" rx="2" fill="#2196f3"/>
                        <polygon points="17,10 22,7 22,17 17,14" fill="#2196f3"/>
                    </svg>
                </button>
                <button title="Info">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="#2196f3">
                        <circle cx="12" cy="12" r="10" fill="#2196f3"/>
                        <rect x="11" y="10" width="2" height="6" rx="1" fill="#fff"/>
                        <rect x="11" y="7" width="2" height="2" rx="1" fill="#fff"/>
                    </svg>
                </button>
                <input type="text" placeholder="Search" />
            </div>
        </div>
        <div class="chat-window" id="chatWindow">
            <!-- Messages will be dynamically added here -->
        </div>
        <div class="chat-input">
            {% if user.profile_picture %}
    <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}" />
{% else %}
    <img src="/static/Areeba.jpeg" alt="Profile" />
{% endif %}
            
            <div class="input-box">
                <button id="fileButton">📎</button>
                <input type="text" id="messageInput" placeholder="#Message" />
                <button id="emojiButton">😊</button>
                <button>
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                        <rect x="9" y="3" width="6" height="12" rx="3" fill="#fff"/>
                        <rect x="11" y="17" width="2" height="4" rx="1" fill="#fff"/>
                        <path d="M7 11v1a5 5 0 0 0 10 0v-1" stroke="#fff" strokeWidth="2" strokeLinecap="round"/>
                    </svg>
                </button>
                <button id="sendButton">➤</button>
            </div>
        </div>
        
        <!-- File Upload Modal -->
        <div class="file-modal" id="fileModal">
            <div class="file-options">
                <label class="file-option">
                    📷 Images
                    <input type="file" id="imageInput" accept="image/*" multiple>
                </label>
                <label class="file-option">
                    🎥 Videos
                    <input type="file" id="videoInput" accept="video/*" multiple>
                </label>
                <label class="file-option">
                    📄 Documents
                    <input type="file" id="documentInput" accept=".pdf,.doc,.docx,.txt,.xls,.xlsx,.ppt,.pptx" multiple>
                </label>
                <label class="file-option">
                    📁 All Files
                    <input type="file" id="allFilesInput" multiple>
                </label>
            </div>
        </div>
        
        <!-- Emoji Picker -->
        <div class="emoji-picker" id="emojiPicker">
            <div class="emoji-grid">
                <button class="emoji-item">😀</button>
                <button class="emoji-item">😂</button>
                <button class="emoji-item">😍</button>
                <button class="emoji-item">😊</button>
                <button class="emoji-item">😎</button>
                <button class="emoji-item">😢</button>
                <button class="emoji-item">😡</button>
                <button class="emoji-item">😱</button>
                <button class="emoji-item">😴</button>
                <button class="emoji-item">🤔</button>
                <button class="emoji-item">👍</button>
                <button class="emoji-item">👎</button>
                <button class="emoji-item">👏</button>
                <button class="emoji-item">🙏</button>
                <button class="emoji-item">❤️</button>
                <button class="emoji-item">💔</button>
                <button class="emoji-item">🔥</button>
                <button class="emoji-item">⭐</button>
                <button class="emoji-item">✅</button>
                <button class="emoji-item">❌</button>
                <button class="emoji-item">🎉</button>
                <button class="emoji-item">💯</button>
                <button class="emoji-item">🚀</button>
                <button class="emoji-item">💡</button>
            </div>
        </div>

        <!-- Invite People Modal -->
        <div class="invite-modal" id="inviteModal">
            <div class="invite-modal-content">
                <div class="invite-modal-header">
                    <h3>Invite People</h3>
                    <button class="close-btn" id="closeInviteModal">&times;</button>
                </div>
                <form class="invite-form" id="inviteForm" method="POST" action="{% url 'add_member_manual' workspace.id %}">
    {% csrf_token %}
    <input type="text" name="identifier" placeholder="Enter Username or Email" required>
    
    <!-- Hidden input for role (will be set by JS when user clicks role option) -->
    <input type="hidden" name="role" id="selectedRole" value="member">

    <div class="invite-options">
        <div class="invite-option" data-role="member">
            <div>👤</div>
            <div>Member</div>
        </div>
        <div class="invite-option" data-role="admin">
            <div>👑</div>
            <div>Admin</div>
        </div>
    </div>
    <button type="submit">Send Invite</button>
</form>

                
            </div>
        </div>
    </div>
    <!-- Profile Modal -->
<div class="profile-modal" id="profileModal">
  <div class="profile-modal-content">
    <div class="profile-modal-header">
      <h3>Edit Profile</h3>
      <button class="close-btn" id="closeProfileModal">&times;</button>
    </div>
    
    <form id="profileForm" method="POST" enctype="multipart/form-data" action="{% url 'update_profile' %}">
      {% csrf_token %}

      <div class="profile-header">
  {% if user.profile_picture %}
    <img src="{{ user.profile_picture.url }}" alt="Profile Picture" class="profile-pic" id="profileImage">
  {% else %}
    <img src="https://via.placeholder.com/120" alt="Profile Picture" class="profile-pic" id="profileImage">
  {% endif %}
  <label for="fileUpload" class="upload-btn"
    {% if profile_saved %}style="pointer-events:none;opacity:0.6;"{% endif %}>
    Upload Picture
  </label>
  <input type="file" name="fileUpload" id="fileUpload" accept="image/*" style="display:none;" {% if profile_saved %}disabled{% endif %}>
</div>
     

      <div class="input-wrap">
        <label for="displayName">Enter Your Display Name</label>
        <input type="text" id="displayName" name="displayName" value="{{ user.display_name }}" {% if profile_saved %}readonly{% endif %}>
      </div>

      <div class="input-wrap">
        <label for="email">Email</label>
        <input type="email" id="email" value="{{ user.email }}" readonly>
      </div>

      <div class="input-wrap">
        <label for="description">Description (max 225 chars)</label>
        <textarea id="description" name="description" maxlength="225" rows="4" {% if profile_saved %}readonly{% endif %}>{{ user.description }}</textarea>
      </div>

      {% if profile_saved %}
        <button type="button" id="saveSmallBtn" class="save-small-btn" disabled>Edit profile</button>
      {% else %}
        <button type="submit" id="saveSmallBtn" class="save-small-btn">Save Changes</button>
      {% endif %}
    </form>
  </div>
</div>

<!-- Settings Modal -->
      <div class="settings-modal" id="settingsModal">
    <div class="settings-modal-content">
        <div class="settings-modal-header">
            <h3>Settings</h3>
            <button class="close-btn" id="closeSettingsModal">&times;</button>
        </div>

        <!-- Remove Users -->
        <div class="settings-section">
            <h4>Remove Users</h4>
            <form id="removeMemberForm" method="POST" action="{% url 'remove_member' workspace.id %}">
                {% csrf_token %}
                <div class="settings-form-group">
                    <label for="usernameInput">Enter Username</label>
                    <input type="text" name="username" id="usernameInput" placeholder="Username" required>
                </div>
                <div class="settings-form-group">
                    <button type="submit" class="danger-btn">Remove User</button>
                </div>
            </form>

            <h4>Delete Workspace</h4>
            <form id="deleteWorkspaceForm" method="POST" action="{% url 'delete_workspace' workspace.id %}">
                {% csrf_token %}
                <div class="settings-form-group">
                    <label for="workspaceTitleInput">Enter Workspace Title to Confirm</label>
                    <input type="text" name="title" id="workspaceTitleInput" placeholder="Workspace Title" required>
                </div>
                <div class="settings-form-group">
                    <button type="submit" class="danger-btn">Delete Workspace</button>
                </div>
            </form>
        </div>


                    

                
                <!-- Privacy & Security -->
               <div class="settings-section">
            <h4>Privacy & Security</h4>
            <div class="settings-form-group">
                <label class="toggle-switch">
                    <input type="checkbox" id="onlineStatusToggle" checked>
                    <span class="toggle-slider"></span>
                </label>
                <span>Show Online Status</span>
            </div>
            <div class="settings-form-group">
                <label class="toggle-switch">
                    <input type="checkbox" id="lastSeenToggle" checked>
                    <span class="toggle-slider"></span>
                </label>
                <span>Show Last Seen</span>
            </div>
            <div class="settings-form-group">
                <label for="blockedUsers">Blocked Users</label>
                <select id="blockedUsers" multiple>
                    <option value="">No blocked users</option>
                </select>
            </div>
        </div>

                <!-- Theme -->
                <div class="settings-section">
                    <h4>Theme</h4>
                    <div class="theme-toggle-container">
                        <div class="theme-option active" data-theme="light">
                            <div class="icon">☀️</div>
                            <div class="label">Light Mode</div>
                        </div>
                        <div class="theme-option" data-theme="dark">
                            <div class="icon">🌙</div>
                            <div class="label">Dark Mode</div>
                        </div>
                    </div>
                </div>

                <!-- Language -->
                <div class="settings-section">
                    <h4>Language</h4>
                    <div class="settings-form-group">
                        <select id="languageSelect">
                            <option value="en">English</option>
                            <option value="ur">Urdu</option>
                            <option value="hi">Hindi</option>
                            <option value="ar">Arabic</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                        </select>
                    </div>
                </div>

                <!-- Chat Settings -->
                <div class="settings-section">
                    <h4>Chat Settings</h4>
                    <div class="settings-form-group">
                        <label for="fontSizeSelect">Font Size</label>
                        <select id="fontSizeSelect">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </div>
                    <div class="settings-form-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="timestampsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <span>Show Timestamps</span>
                    </div>
                </div>

                <!-- Data & Storage -->
                <div class="settings-section">
                    <h4>Data & Storage</h4>
                    <div class="settings-form-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoDownloadToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <span>Media Auto-Download</span>
                    </div>
                    <div class="settings-form-group">
                        <button class="danger-btn" id="clearCacheBtn">Clear Cache</button>
                    </div>
                    <div class="settings-form-group">
                        <label>Storage Usage: <span id="storageUsage">0 MB</span></label>
                    </div>
                </div>
                {% comment %} Delete Workspace {% endcomment %}
               
                </div>

               <div class="settings-actions">
            <button class="settings-btn cancel" id="cancelSettings" type="button">Cancel</button>
        </div>
    </div>
</div>

    <script>
        const messages = [
            {
                id: 1,
                sender: "Areeba",
                avatar: "/static/Areeba.jpeg",
                text: "Hey team, just a reminder about our sprint review tomorrow at 2 PM. Please have your updates ready.",
                side: "left",
            },
            {
                id: 2,
                sender: "Imsha",
                avatar: "/static/Imsha.jpeg",
                text: "Got it, Areeba. Will be prepared.",
                side: "right",
            },
            {
                id: 3,
                sender: "Almas",
                avatar: "/static/Almas.jpeg",
                text: "Sounds good, I'll have my progress report ready.",
                side: "left",
            },
            {
                id: 4,
                sender: "Imsha",
                avatar: "/static/Imsha.jpeg",
                text: "Great! Looking forward to seeing everyone's work.",
                side: "right",
            },
        ];

        const chatWindow = document.getElementById('chatWindow');

        function renderMessages() {
            chatWindow.innerHTML = '';
            messages.forEach(msg => {
                const messageRow = document.createElement('div');
                messageRow.className = `message-row ${msg.side}`;
                if (msg.side === "left") {
                    messageRow.innerHTML = `<img src="${msg.avatar}" alt="${msg.sender}" />
                                            <div>
                                                <span class="sender">${msg.sender}</span>
                                                <div class="message dark">${msg.text}</div>
                                            </div>`;
                } else {
                    messageRow.innerHTML = `<div>
                                                <span class="sender">${msg.sender}</span>
                                                <div class="message blue">${msg.text}</div>
                                            </div>
                                            <img src="${msg.avatar}" alt="${msg.sender}" />`;
                }
                chatWindow.appendChild(messageRow);
            });
        }

        document.getElementById('sendButton').addEventListener('click', () => {
            const messageInput = document.getElementById('messageInput');
            const newMessage = {
                id: messages.length + 1,
                sender: "You",
                avatar: "/static/Areeba.jpeg",
                text: messageInput.value,
                side: "right",
            };
            messages.push(newMessage);
            messageInput.value = '';
            renderMessages();
        });

        renderMessages();
        
        // File Upload Functionality
        const fileButton = document.getElementById('fileButton');
        const fileModal = document.getElementById('fileModal');
        const emojiButton = document.getElementById('emojiButton');
        const emojiPicker = document.getElementById('emojiPicker');
        const messageInput = document.getElementById('messageInput');
        
        // Toggle file modal
        fileButton.addEventListener('click', (e) => {
            e.stopPropagation();
            fileModal.classList.toggle('active');
            emojiPicker.classList.remove('active');
        });
        
        // Toggle emoji picker
        emojiButton.addEventListener('click', (e) => {
            e.stopPropagation();
            emojiPicker.classList.toggle('active');
            fileModal.classList.remove('active');
        });
        
        // Close modals when clicking outside
        document.addEventListener('click', () => {
            fileModal.classList.remove('active');
            emojiPicker.classList.remove('active');
        });
        
        // Prevent modal from closing when clicking inside
        fileModal.addEventListener('click', (e) => e.stopPropagation());
        emojiPicker.addEventListener('click', (e) => e.stopPropagation());
        
        // Handle file uploads
        function handleFileUpload(files, type) {
            Array.from(files).forEach(file => {
                const newMessage = {
                    id: messages.length + 1,
                    sender: "You",
                    avatar: "/static/Areeba.jpeg",
                    text: `📎 ${file.name} (${type})`,
                    side: "right",
                };
                messages.push(newMessage);
            });
            renderMessages();
            fileModal.classList.remove('active');
        }
        
        // File input event listeners
        document.getElementById('imageInput').addEventListener('change', (e) => {
            handleFileUpload(e.target.files, 'Image');
        });
        
        document.getElementById('videoInput').addEventListener('change', (e) => {
            handleFileUpload(e.target.files, 'Video');
        });
        
        document.getElementById('documentInput').addEventListener('change', (e) => {
            handleFileUpload(e.target.files, 'Document');
        });
        
        document.getElementById('allFilesInput').addEventListener('change', (e) => {
            handleFileUpload(e.target.files, 'File');
        });
        
        // Emoji functionality
        document.querySelectorAll('.emoji-item').forEach(emoji => {
            emoji.addEventListener('click', () => {
                messageInput.value += emoji.textContent;
                emojiPicker.classList.remove('active');
            });
        });
       // Open Invite Modal
document.getElementById("openInviteModal").addEventListener("click", function () {
  document.getElementById("inviteModal").classList.add("active");
});

// Close Invite Modal
document.getElementById("closeInviteModal").addEventListener("click", function () {
  document.getElementById("inviteModal").classList.remove("active");
});

// Click outside to close
document.getElementById("inviteModal").addEventListener("click", function (e) {
  if (e.target === this) {
    this.classList.remove("active");
  }
});
        // Invite People Modal Functionality
  
        const inviteOptions = document.querySelectorAll('.invite-option');
const selectedRoleInput = document.getElementById('selectedRole');

// Default role
let selectedRole = 'member';

// Handle role selection
inviteOptions.forEach(option => {
    option.addEventListener('click', () => {
        inviteOptions.forEach(opt => opt.style.background = 'rgba(255,255,255,0.1)');
        option.style.background = 'rgba(255,255,255,0.3)';
        selectedRole = option.dataset.role;

        // Update hidden input so Django can see it
        selectedRoleInput.value = selectedRole;
    });
});

      
// Open modal
document.getElementById("openProfileBtn").addEventListener("click", function () {
  document.getElementById("profileModal").classList.add("active");
});

// Close modal
document.getElementById("closeProfileModal").addEventListener("click", function () {
  document.getElementById("profileModal").classList.remove("active");
});

// Click outside to close
document.getElementById("profileModal").addEventListener("click", function (e) {
  if (e.target === this) {
    this.classList.remove("active");
  }
});

// Place this after your modal HTML or inside a DOMContentLoaded event
const fileUpload = document.getElementById('fileUpload');
const profileImage = document.getElementById('profileImage');

if (fileUpload && profileImage) {
  fileUpload.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      profileImage.src = URL.createObjectURL(file);
    }
  });
}

// Settings Modal Functionality


const settingsButton = document.getElementById('openSettingsBtn');
    const settingsModal = document.getElementById('settingsModal');
    const closeSettingsModal = document.getElementById('closeSettingsModal');
    const cancelSettings = document.getElementById('cancelSettings');

    // Open settings modal
    settingsButton.addEventListener('click', () => {
        settingsModal.classList.add('active');
    });

    // Close by cross button
    closeSettingsModal.addEventListener('click', () => {
        settingsModal.classList.remove('active');
    });

    // Close by cancel button
    cancelSettings.addEventListener('click', () => {
        settingsModal.classList.remove('active');
    });

    // Close modal when clicking outside content
    settingsModal.addEventListener('click', (e) => {
        if (e.target === settingsModal) {
            settingsModal.classList.remove('active');
        }
    });
       
    </script>

    
</body>
</html>

